{% extends "layout.html" %}
{% block content %}
<h3>{{ topic.title }}</h3>
<p class="text-muted">Event date: {{ topic.event_date }}</p>

{% if topic.outcome %}
  <div class="alert alert-success">Resolved: {{ topic.outcome }}</div>
{% else %}
  <form method="POST" class="mb-3">
    <div>
      {% for option in topic.outcomes %}
        <button name="vote" value="{{ option }}" class="vote-option">{{ option }}</button>
      {% endfor %}
    </div>
  </form>
  <form method="POST" action="{{ url_for('resolve_topic', id=topic.id) }}">
    <div class="mt-3">
      <label class="form-label">Resolve Event (Admin)</label>
      <select name="outcome" class="form-select">
        {% for option in topic.outcomes %}
          <option value="{{ option }}">{{ option }}</option>
        {% endfor %}
      </select>
      <button class="btn btn-danger mt-2">Resolve</button>
    </div>
  </form>
{% endif %}

<hr>
<h5>Votes:</h5>
<ul>
  {% for option, count in topic.votes.items() %}
    <li>{{ option }} â€” <b>{{ count }}</b></li>
  {% endfor %}
</ul>

<hr>
<h5>Discussion</h5>
<form method="POST" class="mb-3">
  <input type="text" name="message" placeholder="Write a comment..." class="form-control" required>
  <button class="btn btn-outline-primary mt-2">Send</button>
</form>

{% for msg in topic.messages %}
  <div class="chat-message">{{ msg }}</div>
{% endfor %}
{% endblock %}
